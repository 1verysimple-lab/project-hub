<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol: Pizza (Fast Track)</title>
    <style>
        :root {
            --bg: #121212;
            --surface: #1e1e1e;
            --text: #e0e0e0;
            --accent: #4caf50; /* Green for "Go" */
            --accent-hover: #45a049;
            --border: #333;
            --font-mono: 'Menlo', 'Monaco', monospace;
            --font-sans: system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-sans);
            margin: 0;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Layout */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 1rem; margin-bottom: 2rem; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: -0.02em; }
        
        .controls {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 8px;
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .input-group { display: flex; flex-direction: column; gap: 0.5rem; }
        label { font-size: 0.8rem; text-transform: uppercase; color: #888; letter-spacing: 0.05em; }
        input[type="number"] {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.8rem;
            font-size: 1.5rem;
            width: 80px;
            border-radius: 4px;
            text-align: center;
        }

        /* Recipe Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        @media(max-width:600px) { .grid { grid-template-columns: 1fr; } }

        .card { background: var(--surface); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); }
        .card h3 { margin-top: 0; font-size: 0.9rem; color: #888; text-transform: uppercase; }
        
        .ingredient-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-family: var(--font-mono);
        }
        .ingredient-row:last-child { border-bottom: none; }
        .val { color: var(--accent); font-weight: bold; }

        /* Guide Mode Overlay */
        #guide-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg);
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .step-display {
            font-size: 1.5rem;
            line-height: 1.4;
            max-width: 600px;
            margin-bottom: 3rem;
        }

        .guide-controls { display: flex; gap: 1rem; }

        /* Buttons */
        button {
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        .btn-primary:hover { background: var(--accent-hover); }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
            padding: 1rem 1.5rem;
        }
        .btn-secondary:hover { background: #444; }

        .btn-close {
            position: absolute;
            top: 2rem; right: 2rem;
            background: transparent;
            color: #666;
            font-size: 2rem;
        }

        /* Highlighting dynamic values in text */
        .highlight { color: var(--accent); white-space: nowrap; }

    </style>
</head>
<body>

    <div class="header">
        <h1>Protocol: Fast Pizza</h1>
        <div style="font-size:0.8rem; color:#666;">v2.0 // Same Day Dough</div>
    </div>

    <div id="main-view">
        <div class="controls">
            <div class="input-group">
                <label>Total Pizzas</label>
                <input type="number" id="pizza-count" value="4" min="1" oninput="updateValues()">
            </div>
            <div style="flex-grow:1; text-align:right;">
                <button class="btn-primary" onclick="startGuide()">▶ Start Audio Guide</button>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Dough Ingredients</h3>
                <div id="dough-list"></div>
            </div>
            <div class="card">
                <h3>Sauce Ingredients</h3>
                <div id="sauce-list"></div>
            </div>
        </div>

        <div class="card">
            <h3>Quick Reference</h3>
            <ul style="margin:0; padding-left:1.2rem; color:#aaa; line-height:1.6;">
                <li><strong>Temp:</strong> Max oven (250°C+).</li>
                <li><strong>Timing:</strong> 15 min knead, 2-3 hour rise.</li>
                <li><strong>Order:</strong> Stretch &rarr; Sauce &rarr; Cheese.</li>
            </ul>
        </div>
    </div>

    <div id="guide-overlay">
        <button class="btn-close" onclick="stopGuide()">&times;</button>
        
        <div style="margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.1em; color:#666;">Step <span id="step-number">1</span></div>
        
        <div class="step-display" id="step-text">
            Ready to cook?
        </div>

        <div class="guide-controls">
            <button class="btn-secondary" onclick="prevStep()">Back</button>
            <button class="btn-secondary" onclick="speakCurrentStep()">⟳ Replay</button>
            <button class="btn-primary" onclick="nextStep()" id="btn-next">Next Step</button>
        </div>
    </div>

    <script>
        // RECIPE LOGIC (Fast Dough)
        const BASICS = {
            flour: 150,     // g per pizza
            water: 97.5,    // 65% hydration
            salt: 4.0,      // slightly higher salt for fast dough flavor
            yeast: 5.0,     // FRESH yeast (high amount for speed). Divide by 3 for dry.
            tomato: 90,
            sauceSalt: 1,
            basil: 2
        };

        let currentAmounts = {};
        let currentStepIndex = 0;
        let steps = [];

        function updateValues() {
            const count = parseInt(document.getElementById('pizza-count').value) || 1;
            
            currentAmounts = {
                flour: Math.round(count * BASICS.flour),
                water: Math.round(count * BASICS.water),
                salt: (count * BASICS.salt).toFixed(1),
                yeastFresh: (count * BASICS.yeast).toFixed(1),
                yeastDry: (count * BASICS.yeast / 3).toFixed(1),
                tomato: Math.round(count * BASICS.tomato),
                sauceSalt: (count * BASICS.sauceSalt).toFixed(1),
                basil: count * BASICS.basil
            };

            // Render DOM
            document.getElementById('dough-list').innerHTML = `
                <div class="ingredient-row"><span>Strong Flour</span> <span class="val">${currentAmounts.flour}g</span></div>
                <div class="ingredient-row"><span>Warm Water</span> <span class="val">${currentAmounts.water}ml</span></div>
                <div class="ingredient-row"><span>Salt</span> <span class="val">${currentAmounts.salt}g</span></div>
                <div class="ingredient-row"><span>Yeast (Fresh)</span> <span class="val">${currentAmounts.yeastFresh}g</span></div>
                <div class="ingredient-row" style="color:#666; font-size:0.8em"><span>(or Dry Yeast)</span> <span>${currentAmounts.yeastDry}g</span></div>
            `;

            document.getElementById('sauce-list').innerHTML = `
                <div class="ingredient-row"><span>Tomatoes</span> <span class="val">${currentAmounts.tomato}g</span></div>
                <div class="ingredient-row"><span>Salt</span> <span class="val">${currentAmounts.sauceSalt}g</span></div>
                <div class="ingredient-row"><span>Basil</span> <span class="val">${currentAmounts.basil} leaves</span></div>
            `;
        }

        // STEP GENERATOR (Dynamic Text)
        function generateSteps() {
            return [
                `Right, let's get organized. We are making ${document.getElementById('pizza-count').value} pizzas. You need a large bowl and a clean surface.`,
                
                `First, the liquid. Measure <span class="highlight">${currentAmounts.water} milliliters</span> of warm water (not hot) into your bowl.`,
                
                `Add the yeast. That's <span class="highlight">${currentAmounts.yeastFresh} grams</span> of fresh yeast, or <span class="highlight">${currentAmounts.yeastDry} grams</span> if you're using dry powder. Whisk it until dissolved.`,
                
                `Now, dump in all <span class="highlight">${currentAmounts.flour} grams</span> of flour. Mix it with a spoon until shaggy and no dry powder remains.`,
                
                `Let it rest for 15 minutes. This is the autolyse. Go have a coffee.`,
                
                `Time to work. Add <span class="highlight">${currentAmounts.salt} grams</span> of salt. Knead the dough for 10 minutes. Set a timer. Do not cheat.`,
                
                `The dough should be smooth and spring back when poked. Cover the bowl airtight. Leave it in a warm spot for 2 to 3 hours, until it doubles in size.`,
                
                `While the dough rises, let's do the sauce. Dump <span class="highlight">${currentAmounts.tomato} grams</span> of tomatoes into a bowl. Crush them by hand.`,
                
                `Add <span class="highlight">${currentAmounts.sauceSalt} grams</span> of salt and tear in <span class="highlight">${currentAmounts.basil}</span> basil leaves. Stir and set aside.`,
                
                `Once the dough has risen, divide it into equal balls. You should have ${document.getElementById('pizza-count').value} balls. Cover and let them relax for 30 minutes before baking.`
            ];
        }

        // GUIDE CONTROLS
        function startGuide() {
            steps = generateSteps();
            currentStepIndex = 0;
            document.getElementById('guide-overlay').style.display = 'flex';
            document.getElementById('main-view').style.filter = 'blur(5px)';
            showStep();
            // Small delay to allow transition before speaking
            setTimeout(speakCurrentStep, 500);
        }

        function stopGuide() {
            window.speechSynthesis.cancel();
            document.getElementById('guide-overlay').style.display = 'none';
            document.getElementById('main-view').style.filter = 'none';
        }

        function showStep() {
            const cleanText = steps[currentStepIndex]; // HTML allowed for display
            document.getElementById('step-text').innerHTML = cleanText;
            document.getElementById('step-number').innerText = currentStepIndex + 1;
            
            // Button state
            const btnNext = document.getElementById('btn-next');
            if(currentStepIndex === steps.length - 1) {
                btnNext.innerText = "Finish";
                btnNext.onclick = stopGuide;
            } else {
                btnNext.innerText = "Next Step";
                btnNext.onclick = nextStep;
            }
        }

        function nextStep() {
            if(currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                showStep();
                speakCurrentStep();
            }
        }

        function prevStep() {
            if(currentStepIndex > 0) {
                currentStepIndex--;
                showStep();
                speakCurrentStep();
            }
        }

        // TTS LOGIC
        function speakCurrentStep() {
            window.speechSynthesis.cancel(); // Stop previous
            
            // Strip HTML tags for speech
            const div = document.createElement("div");
            div.innerHTML = steps[currentStepIndex];
            const textToRead = div.textContent || div.innerText || "";

            const utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.rate = 1.0; 
            utterance.pitch = 1.0;

            // Attempt to find a British English voice
            const voices = window.speechSynthesis.getVoices();
            const gbVoice = voices.find(v => v.lang === 'en-GB' || v.name.includes('UK') || v.name.includes('British'));
            if (gbVoice) utterance.voice = gbVoice;

            window.speechSynthesis.speak(utterance);
        }

        // Init
        updateValues();
        // Pre-load voices (browser quirk)
        window.speechSynthesis.getVoices();

    </script>

<!-- BLUES HUB NAVIGATION -->
<a href="https://1verysimple-lab.github.io/project-hub/" 
   target="_blank"
   style="position: fixed; top: 20px; left: 20px; z-index: 9999; display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-decoration: none; color: #e2e8f0; font-family: system-ui, sans-serif; font-size: 13px; font-weight: 500; transition: all 0.2s ease; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);"
   onmouseover="this.style.transform='translateY(-1px)'; this.style.background='rgba(15, 23, 42, 0.95)'"
   onmouseout="this.style.transform='translateY(0)'; this.style.background='rgba(15, 23, 42, 0.8)'">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="14" rx="1"></rect><rect width="7" height="7" x="3" y="14" rx="1"></rect></svg>
    <span>Hub</span>
</a>
<!-- END BLUES HUB NAVIGATION -->

</body>
</html>