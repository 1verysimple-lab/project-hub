<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CS2 Keybind Studio (Offline)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --bg-alt: #0b0f19;
      --panel: #111521;
      --accent: #4f8cff;
      --accent-soft: rgba(79, 140, 255, 0.15);
      --accent-strong: rgba(79, 140, 255, 0.4);
      --text: #f5f5f7;
      --text-muted: #8c93a6;
      --border: #262938;
      --danger: #ff5c7a;
      --success: #41c98b;
      --warning: #ffc857;
      --key-bg: #1a1f2f;
      --key-bg-active: #252c3f;
      --scrollbar-bg: #11131a;
      --scrollbar-thumb: #343b4e;
    }
    .light {
      --bg: #f5f7fb;
      --bg-alt: #ffffff;
      --panel: #ffffff;
      --accent: #2b6cff;
      --accent-soft: rgba(43, 108, 255, 0.1);
      --accent-strong: rgba(43, 108, 255, 0.3);
      --text: #101118;
      --text-muted: #5b6275;
      --border: #d2d5e3;
      --danger: #de3a5a;
      --success: #1f9d67;
      --warning: #e1a742;
      --key-bg: #e9ebf5;
      --key-bg-active: #d6dbf0;
      --scrollbar-bg: #dde1f0;
      --scrollbar-thumb: #b0b5cf;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #15192a 0, #05060a 55%);
      color: var(--text);
    }
    body { display: flex; flex-direction: column; }

    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: var(--scrollbar-bg); }
    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb);
      border-radius: 6px;
    }

    .app { display: flex; flex-direction: column; height: 100vh; }

    header {
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      background: radial-gradient(circle at top left, #1b2740 0, var(--bg-alt) 48%);
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .brand-logo {
      width: 26px; height: 26px;
      border-radius: 8px;
      background: conic-gradient(from 210deg, #4f8cff, #41c98b, #ffc857, #ff5c7a, #4f8cff);
      display: flex; align-items: center; justify-content: center;
      color: #05060a;
      font-size: 14px; font-weight: 700;
      box-shadow: 0 0 0 2px rgba(5, 6, 10, 0.8), 0 8px 18px rgba(0, 0, 0, 0.55);
    }
    .brand-title {
      font-weight: 600;
      font-size: 15px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .brand-sub {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .header-group { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; }
    .header-spacer { flex: 1; }

    button, .btn-label {
      border: 1px solid var(--border);
      background: #15192a;
      color: var(--text);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease,
                  transform 0.06s ease, box-shadow 0.06s ease;
    }
    .btn-label { text-decoration: none; }
    button.icon-btn {
      width: 32px; height: 32px;
      justify-content: center; padding: 0;
    }
    button.primary {
      background: linear-gradient(135deg, #4f8cff, #695dff);
      border-color: transparent;
      color: #fff;
      box-shadow: 0 3px 9px rgba(79, 140, 255, 0.4);
    }
    button.primary:hover { filter: brightness(1.05); transform: translateY(-1px); }
    button:hover, .btn-label:hover {
      background: #1f2336;
      border-color: var(--accent-strong);
      transform: translateY(-1px);
    }
    button:active, .btn-label:active {
      transform: translateY(0);
      box-shadow: none;
    }
    input[type="file"] { display: none; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.1);
      font-size: 11px;
      color: var(--text-muted);
    }
    .pill-dot {
      width: 7px; height: 7px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(65, 201, 139, 0.3);
    }

    .main {
      display: grid;
      grid-template-columns: 260px minmax(0, 2fr) minmax(0, 1.25fr);
      gap: 10px;
      padding: 10px;
      height: calc(100vh - 64px);
    }
    @media (max-width: 1120px) {
      .main {
        grid-template-columns: 1.3fr 1.7fr;
        grid-template-rows: minmax(220px, 260px) minmax(0, 1fr);
        grid-template-areas:
          "left right"
          "center center";
      }
      .left-panel { grid-area: left; }
      .right-panel { grid-area: right; }
      .center-panel { grid-area: center; }
    }
    @media (max-width: 840px) {
      .main {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        grid-template-areas:
          "left"
          "center"
          "right";
        height: auto;
      }
      body, .app { height: auto; min-height: 100vh; }
    }

    .panel {
      background: var(--panel);
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      min-height: 0;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.4);
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 8px;
    }
    .panel-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-muted);
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    .panel-title span {
      text-transform: none;
      letter-spacing: normal;
      font-size: 14px;
      color: var(--text);
    }
    .panel-subtitle { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; }
    .panel-body {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .panel-scroll { overflow-y: auto; padding-right: 4px; }

    .hint { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
    .hint strong { color: var(--text); font-weight: 500; }
    .hint-list { margin: 6px 0 0; padding-left: 18px; font-size: 12px; color: var(--text-muted); }
    .hint-list li { margin-bottom: 3px; }

    .tag-row { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
    .tag {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #15192a;
      border: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .tag-dot {
      width: 7px; height: 7px; border-radius: 999px; background: var(--accent);
    }
    .tag-accent {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: var(--accent-strong);
    }

    hr { border: none; border-top: 1px solid var(--border); opacity: 0.7; margin: 8px 0; }

    .shortcut-row { display: flex; flex-wrap: wrap; gap: 6px; }
    .shortcut-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #15192a;
      color: var(--text-muted);
      cursor: pointer;
    }
    .shortcut-chip:hover {
      border-color: var(--accent-strong);
      color: var(--accent);
    }

    .status-row { display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
    .status-text { font-size: 11px; color: var(--text-muted); }
    .status-dot {
      width: 7px; height: 7px;
      border-radius: 999px;
      background: var(--warning);
      box-shadow: 0 0 0 4px rgba(255, 200, 87, 0.3);
    }
    .status-dot.ok {
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(65, 201, 139, 0.35);
    }
    .status-dot.error {
      background: var(--danger);
      box-shadow: 0 0 0 4px rgba(255, 92, 122, 0.35);
    }

    .keymap-container { display: flex; flex-direction: column; gap: 6px; height: 100%; min-height: 0; }
    .keymap-toolbar {
      display: flex; justify-content: space-between; align-items: center;
      flex-wrap: wrap; gap: 6px;
    }
    .keymap-toolbar-left, .keymap-toolbar-right {
      display: flex; align-items: center; flex-wrap: wrap; gap: 6px;
    }
    .toggle-group {
      display: inline-flex;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.1);
    }
    .toggle-group button {
      border-radius: 0;
      border: none;
      border-right: 1px solid var(--border);
      background: transparent;
      padding: 4px 10px;
      font-size: 11px;
    }
    .toggle-group button:last-child { border-right: none; }
    .toggle-group button.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: transparent;
    }
    .search-input {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 5px 10px;
      background: #131728;
      color: var(--text);
      font-size: 11px;
      min-width: 160px;
    }
    .search-input::placeholder { color: var(--text-muted); }
    .pill-inline {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.06);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .keyboard {
      border-radius: 12px;
      background: radial-gradient(circle at top, #1b2235 0, #141724 40%, #090a10 100%);
      border: 1px solid #25283a;
      padding: 8px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
      display: flex;
      flex-direction: row;
      gap: 6px;
      flex: 1;
      min-height: 0;
    }
    .keyboard-main {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .keyboard-row {
      display: flex;
      gap: 4px;
      justify-content: center;
    }
    .keyboard-numpad {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding-left: 6px;
      border-left: 1px solid rgba(255, 255, 255, 0.04);
    }

    .keycap {
      background: radial-gradient(circle at 15% 0, rgba(255, 255, 255, 0.08) 0, var(--key-bg) 40%, #121524 100%);
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.75);
      color: var(--text-muted);
      font-size: 11px;
      padding: 4px 4px 3px;
      min-width: 28px;
      height: 38px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      box-shadow: 0 3px 0 #05060a, 0 0 0 1px rgba(255, 255, 255, 0.02),
        0 7px 14px rgba(0, 0, 0, 0.85);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
                  border-color 0.12s ease, background 0.12s ease;
      overflow: hidden;
    }
    .keycap[data-bound="true"] {
      border-color: var(--accent-strong);
      color: var(--text);
    }
    .keycap:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 0 #05060a, 0 10px 18px rgba(0, 0, 0, 0.9);
      background: radial-gradient(circle at 20% 0, rgba(255, 255, 255, 0.09) 0, var(--key-bg-active) 40%, #161a2b 100%);
    }
    .keycap.selected {
      box-shadow: 0 1px 0 #05060a, 0 0 0 1px rgba(255, 255, 255, 0.05),
        0 0 0 2px var(--accent-strong), 0 14px 26px rgba(0, 0, 0, 0.9);
      transform: translateY(1px);
      background: linear-gradient(145deg, var(--key-bg-active), #15192b);
    }
    .keycap-top {
      display: flex; justify-content: space-between; align-items: center;
      font-weight: 500;
    }
    .keycap-top-main {
      font-size: 10px;
      text-transform: uppercase;
    }
    .keycap-top-sub { font-size: 9px; opacity: 0.7; }
    .keycap-bind {
      font-size: 10px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .keycap-small { min-width: 26px; }
    .keycap-medium { min-width: 40px; }
    .keycap-large { min-width: 60px; }
    .keycap-xlarge { min-width: 90px; }
    .keycap-space { min-width: 150px; }
    .keycap-tall {
      height: 82px;
      align-self: stretch;
    }

    .mouse-view {
      display: flex;
      gap: 8px;
      padding: 6px;
      border-radius: 10px;
      background: radial-gradient(circle at 10% 0, #22283d 0, #151724 35%, #090a10 100%);
      border: 1px solid #272c3f;
      margin-top: 4px;
    }
    .mouse-body {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
    }
    .mouse-zone {
      border-radius: 10px;
      padding: 6px;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.04);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .mouse-zone-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }
    .mouse-buttons { display: flex; flex-wrap: wrap; gap: 4px; }
    .mouse-btn {
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.75);
      padding: 4px 8px;
      font-size: 10px;
      background: radial-gradient(circle at 20% 0, rgba(255, 255, 255, 0.07) 0, var(--key-bg) 50%, #131624 100%);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 2px 0 #05060a, 0 0 0 1px rgba(255, 255, 255, 0.02);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
                  border-color 0.12s ease, background 0.12s ease;
    }
    .mouse-btn[data-bound="true"] {
      border-color: var(--accent-strong);
      color: var(--text);
    }
    .mouse-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 0 #05060a, 0 8px 12px rgba(0, 0, 0, 0.85);
      background: radial-gradient(circle at 20% 0, rgba(255, 255, 255, 0.09) 0, var(--key-bg-active) 45%, #16192a 100%);
    }
    .mouse-btn.selected {
      box-shadow: 0 1px 0 #05060a, 0 0 0 2px var(--accent-strong);
      transform: translateY(1px);
    }
    .mouse-btn-name {
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 9px;
    }
    .mouse-btn-bind {
      max-width: 110px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 10px;
      color: var(--text-muted);
    }

    .editor-section {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.18);
      border: 1px solid rgba(255, 255, 255, 0.05);
      margin-bottom: 6px;
    }
    .editor-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .editor-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }
    .editor-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .editor-row { display: flex; flex-direction: column; gap: 2px; margin-bottom: 4px; }

    .editor-field-label {
      font-size: 11px;
      color: var(--text-muted);
    }
    .small { font-size: 11px; }
    .muted { color: var(--text-muted); }

    .editor-input,
    .editor-select,
    .editor-textarea {
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #141728;
      color: var(--text);
      font-size: 12px;
      padding: 5px 8px;
      width: 100%;
    }
    .editor-input::placeholder,
    .editor-textarea::placeholder { color: var(--text-muted); }
    .editor-textarea {
      resize: vertical;
      min-height: 58px;
      max-height: 120px;
      font-family: inherit;
      line-height: 1.3;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
    }
    .badge-dot {
      width: 6px; height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }
    .editor-actions { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }

    .pill-key {
      font-family: monospace;
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #141728;
      color: var(--text);
    }

    .advanced-toggle-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 4px;
    }
    .advanced-toggle-row button {
      font-size: 11px;
      padding: 3px 8px;
    }
    .advanced-label {
      font-size: 11px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="brand">
      <div class="brand-logo">C2</div>
      <div>
        <div class="brand-title">CS2 Keybind Studio</div>
        <div class="brand-sub">Offline config visualizer & generator</div>
      </div>
    </div>

    <div class="header-group">
      <label for="configFile" class="btn-label">
        üìÇ <span>Load config</span>
      </label>
      <input type="file" id="configFile" accept=".cfg,.txt" />
      <button id="downloadBtn" class="primary">‚¨áÔ∏è Download config</button>
      <button id="resetBtn">‚ôª Reset session</button>
    </div>

    <div class="header-spacer"></div>

    <div class="header-group">
      <div class="pill">
        <span class="pill-dot"></span>
        <span>Everything runs locally ‚Äì safe to use on any PC</span>
      </div>
      <button id="themeToggle" class="icon-btn" title="Toggle dark / light mode">üåô</button>
    </div>
  </header>

  <main class="main">
    <!-- LEFT PANEL -->
    <section class="panel left-panel">
      <div class="panel-header">
        <div class="panel-title">
          Guide
          <span>How to use this page</span>
        </div>
      </div>
      <div class="panel-body panel-scroll">
        <p class="panel-subtitle"><strong>Goal:</strong> load, see, edit and export your CS2 keybinds without touching console or text editors.</p>

        <div class="hint">
          <strong>1. Where to load your config from</strong>
          <ul class="hint-list">
            <li>Use the <strong>‚ÄúLoad config‚Äù</strong> button at the top.</li>
            <li>Select your <code>autoexec.cfg</code> or any <code>.cfg</code> file.</li>
            <li>Typical folder:
              <br><code>...\Steam\steamapps\common\Counter-Strike Global Offensive\game\csgo\cfg</code>
            </li>
          </ul>
        </div>

        <div class="hint">
          <strong>2. How to see and change binds</strong>
          <ul class="hint-list">
            <li>Click any key on the keyboard or mouse diagram.</li>
            <li>Its bind appears on the right under <strong>Selected key ‚Üí Current bind</strong>.</li>
            <li>Type a new command or click a preset ‚Üí then press <strong>‚ÄúApply to this key‚Äù</strong>.</li>
          </ul>
        </div>

        <div class="hint">
          <strong>3. How to save and use the new config</strong>
          <ul class="hint-list">
            <li>Click <strong>‚ÄúDownload config‚Äù</strong>.</li>
            <li>By default the file is named <code>autoexec.cfg</code> (you can change the name).</li>
            <li>Place it in:
              <br><code>...\Steam\steamapps\common\Counter-Strike Global Offensive\game\csgo\cfg</code>
            </li>
            <li>In CS2, enable the console and run:
              <br><code>exec autoexec</code>
              <br>(or replace <code>autoexec</code> with your file name).</li>
          </ul>
        </div>

        <hr />

        <div class="hint">
          <strong>Filter & focus</strong>
          <p class="small muted">You can highlight keys by category just for you ‚Äì this does not affect the actual config.</p>
          <div class="shortcut-row" style="margin-top:4px;">
            <button class="shortcut-chip" data-filter-category="all">All keys</button>
            <button class="shortcut-chip" data-filter-category="movement">Movement</button>
            <button class="shortcut-chip" data-filter-category="combat">Combat</button>
            <button class="shortcut-chip" data-filter-category="utility">Utility</button>
            <button class="shortcut-chip" data-filter-category="buy">Buy</button>
            <button class="shortcut-chip" data-filter-category="other">Other</button>
          </div>
        </div>

        <hr />

        <div class="hint">
          <strong>Keyboard & numpad layout</strong>
          <ul class="hint-list">
            <li>Numpad keys use casual names: <code>NUM1</code>, <code>NUM+</code>, <code>NUMENTER</code>, etc.</li>
            <li>Use them in binds as-is: <code>bind "NUM1" "buy awp"</code>.</li>
          </ul>
        </div>

        <div class="tag-row">
          <div class="tag tag-accent">
            <div class="tag-dot"></div>
            Visual keyboard ¬∑ Visual mouse ¬∑ Live config preview
          </div>
          <div class="tag">üîÅ Non-destructive ‚Äì you can always re-load your original file</div>
        </div>

        <hr />

        <div class="status-row">
          <span class="status-text" id="statusText">Offline & ready. Load a config or start binding from scratch.</span>
          <div class="status-dot" id="statusDot"></div>
        </div>
      </div>
    </section>

    <!-- CENTER PANEL: KEYBOARD + MOUSE -->
    <section class="panel center-panel">
      <div class="panel-header">
        <div class="panel-title">
          Layout
          <span>Keyboard + mouse overview (with numpad)</span>
        </div>
      </div>
      <div class="panel-body keymap-container">
        <div class="keymap-toolbar">
          <div class="keymap-toolbar-left">
            <div class="toggle-group">
              <button class="active" data-view="keyboard" id="keyboardViewBtn">Keyboard</button>
              <button data-view="mouse" id="mouseViewBtn">Mouse</button>
            </div>
            <div class="pill-inline">Click to edit ¬∑ hover to inspect</div>
          </div>
          <div class="keymap-toolbar-right">
            <input type="text" id="searchInput" class="search-input" placeholder="Search key or command (e.g. jump, smoke, buy awp)‚Ä¶" />
          </div>
        </div>

        <!-- KEYBOARD VIEW -->
        <div id="keyboardContainer" style="flex:1; min-height:0; display:flex; flex-direction:column;">
          <div class="keyboard panel-scroll">
            <div class="keyboard-main">
              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="ESCAPE"><div class="keycap-top"><span class="keycap-top-main">Esc</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F1"><div class="keycap-top"><span class="keycap-top-main">F1</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F2"><div class="keycap-top"><span class="keycap-top-main">F2</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F3"><div class="keycap-top"><span class="keycap-top-main">F3</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F4"><div class="keycap-top"><span class="keycap-top-main">F4</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F5"><div class="keycap-top"><span class="keycap-top-main">F5</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F6"><div class="keycap-top"><span class="keycap-top-main">F6</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F7"><div class="keycap-top"><span class="keycap-top-main">F7</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F8"><div class="keycap-top"><span class="keycap-top-main">F8</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F9"><div class="keycap-top"><span class="keycap-top-main">F9</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F10"><div class="keycap-top"><span class="keycap-top-main">F10</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F11"><div class="keycap-top"><span class="keycap-top-main">F11</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="F12"><div class="keycap-top"><span class="keycap-top-main">F12</span></div><div class="keycap-bind"></div></div>
              </div>

              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="`"><div class="keycap-top"><span class="keycap-top-main">~</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="1"><div class="keycap-top"><span class="keycap-top-main">1</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="2"><div class="keycap-top"><span class="keycap-top-main">2</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="3"><div class="keycap-top"><span class="keycap-top-main">3</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="4"><div class="keycap-top"><span class="keycap-top-main">4</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="5"><div class="keycap-top"><span class="keycap-top-main">5</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="6"><div class="keycap-top"><span class="keycap-top-main">6</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="7"><div class="keycap-top"><span class="keycap-top-main">7</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="8"><div class="keycap-top"><span class="keycap-top-main">8</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="9"><div class="keycap-top"><span class="keycap-top-main">9</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="0"><div class="keycap-top"><span class="keycap-top-main">0</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="-"><div class="keycap-top"><span class="keycap-top-main">-</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="="><div class="keycap-top"><span class="keycap-top-main">=</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-medium" data-key="BACKSPACE"><div class="keycap-top"><span class="keycap-top-main">Back</span></div><div class="keycap-bind"></div></div>
              </div>

              <div class="keyboard-row">
                <div class="keycap keycap-medium" data-key="TAB"><div class="keycap-top"><span class="keycap-top-main">Tab</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="Q"><div class="keycap-top"><span class="keycap-top-main">Q</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="W"><div class="keycap-top"><span class="keycap-top-main">W</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="E"><div class="keycap-top"><span class="keycap-top-main">E</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="R"><div class="keycap-top"><span class="keycap-top-main">R</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="T"><div class="keycap-top"><span class="keycap-top-main">T</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="Y"><div class="keycap-top"><span class="keycap-top-main">Y</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="U"><div class="keycap-top"><span class="keycap-top-main">U</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="I"><div class="keycap-top"><span class="keycap-top-main">I</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="O"><div class="keycap-top"><span class="keycap-top-main">O</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="P"><div class="keycap-top"><span class="keycap-top-main">P</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="["><div class="keycap-top"><span class="keycap-top-main">[</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="]"><div class="keycap-top"><span class="keycap-top-main">]</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-medium" data-key="\\"><div class="keycap-top"><span class="keycap-top-main">\</span></div><div class="keycap-bind"></div></div>
              </div>

              <div class="keyboard-row">
                <div class="keycap keycap-large" data-key="CAPSLOCK"><div class="keycap-top"><span class="keycap-top-main">Caps</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="A"><div class="keycap-top"><span class="keycap-top-main">A</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="S"><div class="keycap-top"><span class="keycap-top-main">S</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="D"><div class="keycap-top"><span class="keycap-top-main">D</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="F"><div class="keycap-top"><span class="keycap-top-main">F</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="G"><div class="keycap-top"><span class="keycap-top-main">G</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="H"><div class="keycap-top"><span class="keycap-top-main">H</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="J"><div class="keycap-top"><span class="keycap-top-main">J</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="K"><div class="keycap-top"><span class="keycap-top-main">K</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="L"><div class="keycap-top"><span class="keycap-top-main">L</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key=";"><div class="keycap-top"><span class="keycap-top-main">;</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="'"><div class="keycap-top"><span class="keycap-top-main">'</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-large" data-key="ENTER"><div class="keycap-top"><span class="keycap-top-main">Enter</span></div><div class="keycap-bind"></div></div>
              </div>

              <div class="keyboard-row">
                <div class="keycap keycap-large" data-key="SHIFT"><div class="keycap-top"><span class="keycap-top-main">Shift</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="Z"><div class="keycap-top"><span class="keycap-top-main">Z</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="X"><div class="keycap-top"><span class="keycap-top-main">X</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="C"><div class="keycap-top"><span class="keycap-top-main">C</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="V"><div class="keycap-top"><span class="keycap-top-main">V</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="B"><div class="keycap-top"><span class="keycap-top-main">B</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="N"><div class="keycap-top"><span class="keycap-top-main">N</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="M"><div class="keycap-top"><span class="keycap-top-main">M</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key=","><div class="keycap-top"><span class="keycap-top-main">,</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="."><div class="keycap-top"><span class="keycap-top-main">.</span></div><div class="keycap-bind"></div></div>
                <div class="keycap" data-key="/"><div class="keycap-top"><span class="keycap-top-main">/</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-large" data-key="RSHIFT"><div class="keycap-top"><span class="keycap-top-main">Shift</span></div><div class="keycap-bind"></div></div>
              </div>

              <div class="keyboard-row">
                <div class="keycap keycap-medium" data-key="CTRL"><div class="keycap-top"><span class="keycap-top-main">Ctrl</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-medium" data-key="ALT"><div class="keycap-top"><span class="keycap-top-main">Alt</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-space" data-key="SPACE"><div class="keycap-top"><span class="keycap-top-main">Space</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-medium" data-key="RALT"><div class="keycap-top"><span class="keycap-top-main">Alt</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-medium" data-key="RCTRL"><div class="keycap-top"><span class="keycap-top-main">Ctrl</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="UP"><div class="keycap-top"><span class="keycap-top-main">‚Üë</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="LEFT"><div class="keycap-top"><span class="keycap-top-main">‚Üê</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="DOWN"><div class="keycap-top"><span class="keycap-top-main">‚Üì</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="RIGHT"><div class="keycap-top"><span class="keycap-top-main">‚Üí</span></div><div class="keycap-bind"></div></div>
              </div>
            </div>

            <!-- NUMPAD -->
            <div class="keyboard-numpad">
              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="NUMLOCK"><div class="keycap-top"><span class="keycap-top-main">Num</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM/"><div class="keycap-top"><span class="keycap-top-main">/</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM*"><div class="keycap-top"><span class="keycap-top-main">*</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM-"><div class="keycap-top"><span class="keycap-top-main">-</span></div><div class="keycap-bind"></div></div>
              </div>
              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="NUM7"><div class="keycap-top"><span class="keycap-top-main">NUM7</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM8"><div class="keycap-top"><span class="keycap-top-main">NUM8</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM9"><div class="keycap-top"><span class="keycap-top-main">NUM9</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-tall keycap-small" data-key="NUM+"><div class="keycap-top"><span class="keycap-top-main">+</span></div><div class="keycap-bind"></div></div>
              </div>
              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="NUM4"><div class="keycap-top"><span class="keycap-top-main">NUM4</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM5"><div class="keycap-top"><span class="keycap-top-main">NUM5</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM6"><div class="keycap-top"><span class="keycap-top-main">NUM6</span></div><div class="keycap-bind"></div></div>
              </div>
              <div class="keyboard-row">
                <div class="keycap keycap-small" data-key="NUM1"><div class="keycap-top"><span class="keycap-top-main">NUM1</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM2"><div class="keycap-top"><span class="keycap-top-main">NUM2</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM3"><div class="keycap-top"><span class="keycap-top-main">NUM3</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-tall keycap-small" data-key="NUMENTER"><div class="keycap-top"><span class="keycap-top-main">Enter</span></div><div class="keycap-bind"></div></div>
              </div>
              <div class="keyboard-row">
                <div class="keycap keycap-large" data-key="NUM0"><div class="keycap-top"><span class="keycap-top-main">NUM0</span></div><div class="keycap-bind"></div></div>
                <div class="keycap keycap-small" data-key="NUM."><div class="keycap-top"><span class="keycap-top-main">.</span></div><div class="keycap-bind"></div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- MOUSE VIEW -->
        <div id="mouseContainer" style="display:none;">
          <div class="mouse-view">
            <div class="mouse-body">
              <div class="mouse-zone">
                <div class="mouse-zone-title">Main buttons</div>
                <div class="mouse-buttons">
                  <div class="mouse-btn" data-key="MOUSE1"><span class="mouse-btn-name">M1</span><span class="mouse-btn-bind"></span></div>
                  <div class="mouse-btn" data-key="MOUSE2"><span class="mouse-btn-name">M2</span><span class="mouse-btn-bind"></span></div>
                  <div class="mouse-btn" data-key="MOUSE3"><span class="mouse-btn-name">M3</span><span class="mouse-btn-bind"></span></div>
                </div>
              </div>
              <div class="mouse-zone">
                <div class="mouse-zone-title">Side / extra</div>
                <div class="mouse-buttons">
                  <div class="mouse-btn" data-key="MOUSE4"><span class="mouse-btn-name">M4</span><span class="mouse-btn-bind"></span></div>
                  <div class="mouse-btn" data-key="MOUSE5"><span class="mouse-btn-name">M5</span><span class="mouse-btn-bind"></span></div>
                </div>
              </div>
              <div class="mouse-zone">
                <div class="mouse-zone-title">Scroll wheel</div>
                <div class="mouse-buttons">
                  <div class="mouse-btn" data-key="MWHEELUP"><span class="mouse-btn-name">Scroll ‚Üë</span><span class="mouse-btn-bind"></span></div>
                  <div class="mouse-btn" data-key="MWHEELDOWN"><span class="mouse-btn-name">Scroll ‚Üì</span><span class="mouse-btn-bind"></span></div>
                </div>
              </div>
            </div>
            <div style="width:190px; display:flex; flex-direction:column; gap:4px;">
              <div class="editor-section">
                <div class="editor-section-header">
                  <div class="editor-section-title">Mouse tips</div>
                </div>
                <p class="hint">
                  Side buttons are great for grenades, quick switch, and voice toggle.
                  Scroll jump is still allowed as long as it‚Äôs just <code>+jump</code>.
                </p>
              </div>
              <div class="editor-section">
                <div class="editor-section-header">
                  <div class="editor-section-title">Legend</div>
                </div>
                <ul class="hint-list">
                  <li>Glow = key/button has a bind</li>
                  <li>Blue outline = currently selected</li>
                  <li>Empty text = currently unbound</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- RIGHT PANEL: EDITOR + ADVANCED VIEW -->
    <section class="panel right-panel">
      <div class="panel-header">
        <div class="panel-title">
          Editor
          <span>Select, change & preview binds</span>
        </div>
      </div>
      <div class="panel-body panel-scroll">
        <!-- Selected key -->
        <div class="editor-section">
          <div class="editor-section-header">
            <div class="editor-section-title">Selected key</div>
            <span class="badge" id="selectedKeyBadge"><span class="badge-dot"></span> None selected</span>
          </div>
          <div class="editor-grid">
            <div class="editor-row">
              <label class="editor-field-label">Key name</label>
              <div id="selectedKeyName" class="pill-key">Click any key or mouse button</div>
            </div>
            <div class="editor-row">
              <label class="editor-field-label">Category hint (for filter only)</label>
              <select id="categorySelect" class="editor-select">
                <option value="auto">Auto detect</option>
                <option value="movement">Movement</option>
                <option value="combat">Combat / aim</option>
                <option value="utility">Utility / grenades</option>
                <option value="buy">Buy binds</option>
                <option value="other">Other / misc</option>
              </select>
            </div>
          </div>
          <div class="editor-row">
            <label class="editor-field-label">
              Current bind
              <span class="small muted">(raw CS2 command)</span>
            </label>
            <input type="text" id="commandInput" class="editor-input" placeholder='Example: +jump, use weapon_smokegrenade, buy awp' />
          </div>
          <div class="editor-actions">
            <button id="applyBindBtn" class="primary">‚úÖ Apply to this key</button>
            <button id="clearBindBtn">üßπ Clear bind</button>
          </div>
        </div>

        <!-- Common presets -->
        <div class="editor-section">
          <div class="editor-section-header">
            <div class="editor-section-title">Common presets</div>
            <span class="small muted">Click a preset to fill the command box</span>
          </div>

          <div class="editor-row">
            <label class="editor-field-label">Movement</label>
            <div class="shortcut-row">
              <button class="shortcut-chip" data-command="+forward">+forward</button>
              <button class="shortcut-chip" data-command="+back">+back</button>
              <button class="shortcut-chip" data-command="+moveleft">+moveleft</button>
              <button class="shortcut-chip" data-command="+moveright">+moveright</button>
              <button class="shortcut-chip" data-command="+jump">+jump</button>
              <button class="shortcut-chip" data-command="+duck">+duck</button>
            </div>
          </div>

          <div class="editor-row">
            <label class="editor-field-label">Grenades</label>
            <div class="shortcut-row">
              <button class="shortcut-chip" data-command="use weapon_smokegrenade">Smoke</button>
              <button class="shortcut-chip" data-command="use weapon_flashbang">Flash</button>
              <button class="shortcut-chip" data-command="use weapon_hegrenade">HE</button>
              <button class="shortcut-chip" data-command="use weapon_incgrenade; use weapon_molotov">Molotov/Incendiary</button>
              <button class="shortcut-chip" data-command="use weapon_decoy">Decoy</button>
            </div>
          </div>

          <div class="editor-row">
            <label class="editor-field-label">Buy binds</label>
            <div class="shortcut-row">
              <button class="shortcut-chip" data-command="buy ak47; buy m4a1_silencer">AK / M4</button>
              <button class="shortcut-chip" data-command="buy awp">AWP</button>
              <button class="shortcut-chip" data-command="buy deagle">Deagle</button>
              <button class="shortcut-chip" data-command="buy vesthelm; buy vest">Kevlar + helmet</button>
              <button class="shortcut-chip" data-command="buy defuser">Defuse kit</button>
            </div>
          </div>

          <div class="editor-row">
            <label class="editor-field-label">Toggles & QoL</label>
            <div class="shortcut-row">
              <button class="shortcut-chip" data-command="toggle cl_righthand 0 1">Switch hands</button>
              <button class="shortcut-chip" data-command="r_cleardecals">Clear decals</button>
              <button class="shortcut-chip" data-command="toggle voice_enable 0 1">Toggle voice</button>
              <button class="shortcut-chip" data-command="toggle volume 0.4 1">Toggle volume</button>
              <button class="shortcut-chip" data-command="+lookatweapon">Inspect weapon</button>
              <button class="shortcut-chip" data-command="lastinv">Quick switch</button>
            </div>
          </div>
        </div>

        <!-- Aliases -->
        <div class="editor-section">
          <div class="editor-section-header">
            <div class="editor-section-title">Aliases detected</div>
          </div>
          <div class="editor-row">
            <label class="editor-field-label">Read-only aliases from your loaded config</label>
            <textarea id="aliasesPreview" class="editor-textarea" readonly placeholder="Load a config to see detected alias definitions here."></textarea>
          </div>
        </div>

        <!-- Advanced / live config preview -->
        <div class="editor-section">
          <div class="editor-section-header">
            <div class="editor-section-title">Export & advanced view</div>
          </div>
          <div class="editor-row">
            <label class="editor-field-label">Output file name</label>
            <input type="text" id="filenameInput" class="editor-input" value="autoexec.cfg" />
          </div>
          <div class="editor-row">
            <label class="editor-field-label">Export options</label>
            <div class="shortcut-row">
              <label class="shortcut-chip">
                <input type="checkbox" id="includeHostWrite" checked style="margin-right:4px;" />
                include <code>host_writeconfig</code>
              </label>
              <label class="shortcut-chip">
                <input type="checkbox" id="includeComments" checked style="margin-right:4px;" />
                include helpful comments
              </label>
            </div>
          </div>
          <div class="advanced-toggle-row">
            <span class="advanced-label">Live preview of the config that will be downloaded:</span>
          </div>
          <div class="editor-row" style="margin-top:4px;">
            <textarea id="advancedPreview" class="editor-textarea" style="min-height:140px;" readonly placeholder="// This will update as you change binds or options."></textarea>
          </div>
          <p class="small muted">
            After downloading, put the file in your <code>csgo\cfg</code> folder and run <code>exec &lt;filename&gt;</code> in the CS2 console.
          </p>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  const state = {
    binds: {},   // key -> command
    aliases: {}, // name -> command
    selectedKey: null,
    filterCategory: "all",
    searchQuery: "",
    theme: "dark"
  };

  const categoryPatterns = {
    movement: ["+forward", "+back", "+moveleft", "+moveright", "+jump", "+duck", "+speed"],
    combat: ["+attack", "+attack2", "+reload", "lastinv"],
    utility: ["weapon_smokegrenade", "weapon_flashbang", "weapon_incgrenade", "weapon_molotov", "weapon_hegrenade", "weapon_decoy", "cl_righthand", "r_cleardecals"],
    buy: ["buy "]
  };

  function $(sel, root=document) { return root.querySelector(sel); }
  function $all(sel, root=document) { return Array.from(root.querySelectorAll(sel)); }

  function setStatus(text, level="info") {
    const t = $("#statusText");
    const d = $("#statusDot");
    if (!t || !d) return;
    t.textContent = text;
    d.classList.remove("ok", "error");
    if (level === "ok") d.classList.add("ok");
    else if (level === "error") d.classList.add("error");
  }

  function parseConfig(text) {
    const binds = {};
    const aliases = {};
    const lines = text.split(/\r?\n/);
    for (let line of lines) {
      const trimmed = line.trim();
      if (!trimmed || trimmed.startsWith("//")) continue;
      if (trimmed.toLowerCase().startsWith("bind")) {
        const m = trimmed.match(/bind\s+"(.+?)"\s+"(.+?)"/i);
        if (m) binds[m[1]] = m[2];
      } else if (trimmed.toLowerCase().startsWith("alias")) {
        const m = trimmed.match(/alias\s+"(.+?)"\s+"(.+?)"/i);
        if (m) aliases[m[1]] = m[2];
      }
    }
    return { binds, aliases };
  }

  function guessCategory(command) {
    if (!command) return "other";
    const c = command.toLowerCase();
    for (const [cat, pats] of Object.entries(categoryPatterns)) {
      if (pats.some(p => c.includes(p))) return cat;
    }
    return "other";
  }

  function passesFilter(key, command) {
    const q = state.searchQuery.trim().toLowerCase();
    const cat = state.filterCategory;
    if (q) {
      const km = key.toLowerCase().includes(q);
      const cm = (command || "").toLowerCase().includes(q);
      if (!km && !cm) return false;
    }
    if (cat === "all") return true;
    const g = guessCategory(command);
    return g === cat;
  }

  function updateKeyVisual(key, command) {
    const keyboardEl = document.querySelector(\`.keycap[data-key="\${CSS.escape(key)}"]\`);
    const mouseEl = document.querySelector(\`.mouse-btn[data-key="\${CSS.escape(key)}"]\`);
    const apply = (el) => {
      if (!el) return;
      el.dataset.bound = command ? "true" : "false";
      const label = el.querySelector(".keycap-bind, .mouse-btn-bind");
      if (label) label.textContent = command || "";
      el.title = command ? (key + " ‚Üí " + command) : key;
      const show = passesFilter(key, command);
      el.style.opacity = show ? "1" : "0.2";
    };
    apply(keyboardEl);
    apply(mouseEl);
  }

  function renderAll() {
    $all(".keycap").forEach(el => {
      const key = el.dataset.key;
      const cmd = state.binds[key] || "";
      updateKeyVisual(key, cmd);
    });
    $all(".mouse-btn").forEach(el => {
      const key = el.dataset.key;
      const cmd = state.binds[key] || "";
      updateKeyVisual(key, cmd);
    });
    const aliasLines = Object.entries(state.aliases).map(([n, c]) => \`alias "\${n}" "\${c}"\`);
    $("#aliasesPreview").value = aliasLines.join("\\n");
    updateAdvancedPreview();
  }

  function selectKey(key) {
    state.selectedKey = key;
    $all(".keycap, .mouse-btn").forEach(el => el.classList.remove("selected"));
    const kEl = document.querySelector(\`.keycap[data-key="\${CSS.escape(key)}"]\`);
    const mEl = document.querySelector(\`.mouse-btn[data-key="\${CSS.escape(key)}"]\`);
    if (kEl) kEl.classList.add("selected");
    if (mEl) mEl.classList.add("selected");

    $("#selectedKeyName").textContent = key;
    const cmd = state.binds[key] || "";
    $("#commandInput").value = cmd;

    const badge = $("#selectedKeyBadge");
    badge.innerHTML = "";
    const dot = document.createElement("span");
    dot.className = "badge-dot";
    badge.appendChild(dot);
    badge.appendChild(document.createTextNode(" Editing " + key));
  }

  function applyBind() {
    if (!state.selectedKey) {
      alert("Select a key or mouse button first.");
      return;
    }
    const cmd = $("#commandInput").value.trim();
    if (cmd) state.binds[state.selectedKey] = cmd;
    else delete state.binds[state.selectedKey];
    updateKeyVisual(state.selectedKey, cmd);
    updateAdvancedPreview();
    setStatus("Updated bind for " + state.selectedKey + ".", "ok");
  }

  function clearBind() {
    if (!state.selectedKey) {
      alert("Select a key or mouse button first.");
      return;
    }
    delete state.binds[state.selectedKey];
    $("#commandInput").value = "";
    updateKeyVisual(state.selectedKey, "");
    updateAdvancedPreview();
    setStatus("Cleared bind for " + state.selectedKey + ".", "ok");
  }

  function buildConfigText() {
    const lines = [];
    const includeComments = $("#includeComments").checked;

    if (includeComments) {
      lines.push("// Generated by CS2 Keybind Studio");
      lines.push("// Edit by hand if you want ‚Äì this is standard CS2 config syntax.");
      lines.push("");
    }

    const keys = Object.keys(state.binds).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
    for (const k of keys) {
      const cmd = state.binds[k];
      if (!cmd) continue;
      lines.push(\`bind "\${k}" "\${cmd}"\`);
    }

    const aliasNames = Object.keys(state.aliases);
    if (aliasNames.length) {
      lines.push("");
      if (includeComments) lines.push("// Alias definitions from your original config");
      for (const name of aliasNames) {
        lines.push(\`alias "\${name}" "\${state.aliases[name]}"\`);
      }
    }

    if ($("#includeHostWrite").checked) {
      lines.push("");
      lines.push("host_writeconfig");
    }

    return lines.join("\\n");
  }

  function updateAdvancedPreview() {
    $("#advancedPreview").value = buildConfigText();
  }

  function downloadConfig() {
    const text = buildConfigText();
    const blob = new Blob([text], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const filename = $("#filenameInput").value.trim() || "autoexec.cfg";
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    setStatus("Config downloaded. Place it in csgo\\cfg and use exec in-game.", "ok");
  }

  function handleFileChange(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      const text = ev.target.result;
      const { binds, aliases } = parseConfig(text);
      state.binds = { ...binds };
      state.aliases = { ...aliases };
      renderAll();
      setStatus(\`Loaded \${Object.keys(binds).length} binds and \${Object.keys(aliases).length} aliases.\`, "ok");
    };
    reader.readAsText(file);
  }

  function resetSession() {
    if (!confirm("Reset everything and clear current binds?")) return;
    state.binds = {};
    state.aliases = {};
    state.selectedKey = null;
    state.filterCategory = "all";
    state.searchQuery = "";
    $("#searchInput").value = "";
    $("#selectedKeyName").textContent = "Click any key or mouse button";
    $("#selectedKeyBadge").innerHTML = '<span class="badge-dot"></span> None selected';
    $("#commandInput").value = "";
    $("#aliasesPreview").value = "";
    $all(".keycap, .mouse-btn").forEach(el => {
      el.dataset.bound = "false";
      const b = el.querySelector(".keycap-bind, .mouse-btn-bind");
      if (b) b.textContent = "";
      el.title = el.dataset.key || "";
      el.classList.remove("selected");
      el.style.opacity = "1";
    });
    updateAdvancedPreview();
    setStatus("Session reset. Load a config or start fresh.", "info");
  }

  function toggleTheme() {
    const app = $("#app");
    const btn = $("#themeToggle");
    if (state.theme === "dark") {
      state.theme = "light";
      app.classList.add("light");
      btn.textContent = "‚òÄÔ∏è";
    } else {
      state.theme = "dark";
      app.classList.remove("light");
      btn.textContent = "üåô";
    }
  }

  function setView(view) {
    if (view === "keyboard") {
      $("#keyboardContainer").style.display = "flex";
      $("#mouseContainer").style.display = "none";
      $("#keyboardViewBtn").classList.add("active");
      $("#mouseViewBtn").classList.remove("active");
    } else {
      $("#keyboardContainer").style.display = "none";
      $("#mouseContainer").style.display = "block";
      $("#keyboardViewBtn").classList.remove("active");
      $("#mouseViewBtn").classList.add("active");
    }
  }

  function handlePresetClick(e) {
    const cmd = e.currentTarget.dataset.command;
    if (!cmd) return;
    $("#commandInput").value = cmd;
  }

  function handleFilterCategory(e) {
    const cat = e.currentTarget.dataset.filterCategory || "all";
    state.filterCategory = cat;
    $all(".shortcut-chip[data-filter-category]").forEach(btn => {
      btn.classList.toggle("tag-accent", btn.dataset.filterCategory === cat);
    });
    renderAll();
  }

  function handleSearchInput(e) {
    state.searchQuery = e.target.value || "";
    renderAll();
  }

  function init() {
    $("#configFile").addEventListener("change", handleFileChange);
    $("#downloadBtn").addEventListener("click", downloadConfig);
    $("#resetBtn").addEventListener("click", resetSession);
    $("#applyBindBtn").addEventListener("click", applyBind);
    $("#clearBindBtn").addEventListener("click", clearBind);
    $("#themeToggle").addEventListener("click", toggleTheme);
    $("#keyboardViewBtn").addEventListener("click", () => setView("keyboard"));
    $("#mouseViewBtn").addEventListener("click", () => setView("mouse"));

    $all(".keycap").forEach(el => {
      el.addEventListener("click", () => {
        const key = el.dataset.key;
        if (key) selectKey(key);
      });
    });
    $all(".mouse-btn").forEach(el => {
      el.addEventListener("click", () => {
        const key = el.dataset.key;
        if (key) selectKey(key);
      });
    });

    $all(".shortcut-chip[data-command]").forEach(el => {
      el.addEventListener("click", handlePresetClick);
    });
    $all(".shortcut-chip[data-filter-category]").forEach(el => {
      el.addEventListener("click", handleFilterCategory);
    });

    $("#searchInput").addEventListener("input", handleSearchInput);
    $("#includeComments").addEventListener("change", updateAdvancedPreview);
    $("#includeHostWrite").addEventListener("change", updateAdvancedPreview);

    updateAdvancedPreview();
    setStatus("Offline & ready. Load a config or start binding from scratch.", "info");
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
